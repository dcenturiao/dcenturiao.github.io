---
---
{%- comment -%}
APA-style Jekyll Scholar entry template
- No preview/thumb, no pills or badges
- Year headings come from `--group_by year` in the page call
- Reference: Authors (Year). Title. *Journal, Volume*(Issue), pages. DOI/URL
{%- endcomment -%}

{%- comment -%} Build APA-style author string {%- endcomment -%}
{%- capture apa_authors -%}
  {%- assign n = entry.author_array | size -%}
  {%- for a in entry.author_array -%}
    {%- assign initials = "" -%}
    {%- assign first_parts = a.first | split: ' ' -%}
    {%- for fp in first_parts -%}
      {%- capture initials -%}{{ initials }}{{ fp | slice: 0, 1 | upcase }}.{%- endcapture -%}
    {%- endfor -%}
    {%- assign name_formatted = a.last | append: ", " | append: initials -%}

    {%- if forloop.last and n > 1 -%}
      &nbsp;&amp;&nbsp;{{ name_formatted }}
    {%- elsif forloop.first -%}
      {{ name_formatted }}
    {%- else -%}
      , {{ name_formatted }}
    {%- endif -%}
  {%- endfor -%}
{%- endcapture -%}

{%- comment -%} Choose best link (DOI > URL > PDF) {%- endcomment -%}
{%- assign doi_link = nil -%}
{%- if entry.doi %}{% assign doi_link = 'https://doi.org/' | append: entry.doi %}{% endif -%}
{%- assign best_link = doi_link | default: entry.url | default: entry.pdf -%}

{%- capture venue -%}
  {%- if entry.type == "article" and entry.journal -%}
    <em>{{ entry.journal }}</em>
  {%- elsif entry.booktitle -%}
    <em>{{ entry.booktitle }}</em>
  {%- endif -%}
{%- endcapture -%}

{%- capture vol_issue -%}
  {%- if entry.volume %}<em>{{ entry.volume }}</em>{% endif -%}
  {%- if entry.number %}({{ entry.number }}){% endif -%}
{%- endcapture -%}

{%- capture pages -%}{% if entry.pages %}{{ entry.pages }}{% endif -%}{%- endcapture -%}
{%- capture year -%}{% if entry.year %}{{ entry.year }}{% endif -%}{%- endcapture -%}

<div id="{{ entry.key }}" class="bib-entry apa-ref">

  <p>
    <!-- Authors -->
    {{ apa_authors | strip }}
    {% if year %} ({{ year }}).{% endif %}

    <!-- Title -->
    {% if best_link %}
      <a href="{{ best_link }}">{{ entry.title }}</a>.
    {% else %}
      {{ entry.title }}.
    {% endif %}

    <!-- Venue -->
    {{ venue }}
    {%- if venue and (vol_issue or pages) -%}, {% endif -%}
    {{ vol_issue }}{%- if vol_issue and pages -%}, {{ pages }}{%- endif -%}.

    <!-- Inline DOI/URL -->
    {% if doi_link %}
      <a href="{{ doi_link }}">{{ doi_link }}</a>
    {% elsif entry.url %}
      <a href="{{ entry.url }}">{{ entry.url }}</a>
    {% elsif entry.pdf %}
      <a href="{{ entry.pdf }}">{{ entry.pdf }}</a>
    {% endif %}
  </p>

</div>
